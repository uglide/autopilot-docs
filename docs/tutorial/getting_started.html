
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Writing Your First Test &#8212; Autopilot 1.5 documentation</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/centertext.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Advanced Autopilot Features" href="advanced_autopilot.html" />
    <link rel="prev" title="Autopilot Tutorial" href="tutorial.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="advanced_autopilot.html" title="Advanced Autopilot Features"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tutorial.html" title="Autopilot Tutorial"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Autopilot 1.5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="tutorial.html" accesskey="U">Autopilot Tutorial</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="writing-your-first-test">
<h1>Writing Your First Test<a class="headerlink" href="#writing-your-first-test" title="Permalink to this headline">¶</a></h1>
<p>This document contains everything you need to know to write your first autopilot test. It covers writing several simple tests for a sample Qt5/Qml application. However, it’s important to note that nothing in this tutorial is specific to Qt5/Qml, and will work equally well with any other kind of application.</p>
<div class="section" id="files-and-directories">
<h2>Files and Directories<a class="headerlink" href="#files-and-directories" title="Permalink to this headline">¶</a></h2>
<p>Your autopilot test suite will grow to several files, possibly spread across several directories. We recommend that you follow this simple directory layout:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">autopilot</span><span class="o">/</span>
<span class="n">autopilot</span><span class="o">/&lt;</span><span class="n">projectname</span><span class="o">&gt;/</span>
<span class="n">autopilot</span><span class="o">/&lt;</span><span class="n">projectname</span><span class="o">&gt;/</span><span class="n">tests</span><span class="o">/</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">autopilot</span></code> folder can be anywhere within your project’s source tree. It will likely contain a <a class="reference external" href="http://docs.python.org/3/distutils/setupscript.html">setup.py</a> file.</p>
<p>The <code class="docutils literal"><span class="pre">autopilot/&lt;projectname&gt;/</span></code> folder is the base package for your autopilot tests. This folder, and all child folders, are python packages, and so must contain an <a class="reference external" href="http://docs.python.org/3/tutorial/modules.html#packages">__init__.py file</a>. If you ever find yourself writing custom proxy classes (This is an advanced topic, and is covered here: <a class="reference internal" href="advanced_autopilot.html#custom-proxy-classes"><span class="std std-ref">Writing Custom Proxy Classes</span></a>), they should be imported from this top-level package.</p>
<p>Each test file should be named <code class="docutils literal"><span class="pre">test_&lt;component&gt;.py</span></code>, where <em>&lt;component&gt;</em> is the logical component you are testing in that file. Test files must be written in the <code class="docutils literal"><span class="pre">autopilot/&lt;projectname&gt;/tests/</span></code> folder.</p>
<div class="section" id="a-minimal-test-case">
<h3>A Minimal Test Case<a class="headerlink" href="#a-minimal-test-case" title="Permalink to this headline">¶</a></h3>
<p>Autopilot tests follow a similar pattern to other python test libraries: you must declare a class that derives from <code class="xref py py-class docutils literal"><span class="pre">AutopilotTestCase</span></code>. A minimal test case looks like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">autopilot.testcase</span> <span class="k">import</span> <span class="n">AutopilotTestCase</span>


<span class="k">class</span> <span class="nc">MyTests</span><span class="p">(</span><span class="n">AutopilotTestCase</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">test_something</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;An example test case that will always pass.&quot;&quot;&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-setup-phase">
<h2>The Setup Phase<a class="headerlink" href="#the-setup-phase" title="Permalink to this headline">¶</a></h2>
<p>Before each test is run, the <code class="docutils literal"><span class="pre">setUp</span></code> method is called. Test authors may override this method to run any setup that needs to happen before the test is run. However, care must be taken when using the <code class="docutils literal"><span class="pre">setUp</span></code> method: it tends to hide code from the test case, which can make your tests less readable. It is our recommendation, therefore, that you use this feature sparingly. A more suitable alternative is often to put the setup code in a separate function or method and call it from the test function.</p>
<p>Should you wish to put code in a setup method, it looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">autopilot.testcase</span> <span class="kn">import</span> <span class="n">AutopilotTestCase</span>


<span class="k">class</span> <span class="nc">MyTests</span><span class="p">(</span><span class="n">AutopilotTestCase</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">MyTests</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
                <span class="c1"># This code gets run before every test!</span>

        <span class="k">def</span> <span class="nf">test_something</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot;An example test case that will always pass.&quot;&quot;&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Any action you take in the setup phase must be undone if it alters the system state. See <a class="reference internal" href="advanced_autopilot.html#cleaning-up"><span class="std std-ref">Cleaning Up</span></a> for more details.</p>
</div>
<div class="section" id="starting-the-application">
<h3>Starting the Application<a class="headerlink" href="#starting-the-application" title="Permalink to this headline">¶</a></h3>
<p>At the start of your test, you need to tell autopilot to launch your application. To do this, call <code class="xref py py-meth docutils literal"><span class="pre">launch_test_application</span></code>. The minimum required argument to this method is the application name or path. If you pass in the application name, autopilot will look in the current working directory, and then will search the <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal"><span class="pre">PATH</span></code> environment variable. Otherwise, autopilot looks for the executable at the path specified. Positional arguments to this method are passed to the executable being launched.</p>
<p>Autopilot will try and guess what type of application you are launching, and therefore what kind of introspection libraries it should load. Sometimes autopilot will need some assistance however. For example, at the time of writing, autopilot cannot automatically detect the introspection type for python / Qt4 applications. In that case, a <code class="xref py py-class docutils literal"><span class="pre">RuntimeError</span></code> will be raised. To provide autopilot with a hint as to which introspection type to load, you can provide the <code class="docutils literal"><span class="pre">app_type</span></code> keyword argument. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyTests</span><span class="p">(</span><span class="n">AutopilotTestCase</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">test_python_qt4_application</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">launch_test_application</span><span class="p">(</span>
                        <span class="s1">&#39;my-pyqt4-app&#39;</span><span class="p">,</span>
                        <span class="n">app_type</span><span class="o">=</span><span class="s1">&#39;qt&#39;</span>
                        <span class="p">)</span>
</pre></div>
</div>
<p>See the documentation for <code class="xref py py-meth docutils literal"><span class="pre">launch_test_application</span></code> for more details.</p>
<p>The return value from <code class="xref py py-meth docutils literal"><span class="pre">launch_test_application</span></code> is a proxy object representing the root of the introspection tree of the application you just launched.</p>
</div>
</div>
<div class="section" id="a-simple-test">
<h2>A Simple Test<a class="headerlink" href="#a-simple-test" title="Permalink to this headline">¶</a></h2>
<p>To demonstrate the material covered so far, this selection will outline a simple application, and a single test for it. Instead of testing a third-party application, we will write the simplest possible application in Python and Qt4. The application, named ‘testapp.py’, is listed below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="k">import</span> <span class="n">QtGui</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="k">import</span> <span class="n">argv</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
        <span class="n">win</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMainWindow</span><span class="p">()</span>
        <span class="n">win</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">win</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
        <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>As you can see, this is a trivial application, but it serves our purpose. For the upcoming tests to run this file must be executable:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ chmod u+x testapp.py
</pre></div>
</div>
<p>We will write a single autopilot test that asserts that the title of the main window is equal to the string “Hello World”. Our test file is named “test_window.py”, and contains the following code:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">autopilot.testcase</span> <span class="k">import</span> <span class="n">AutopilotTestCase</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">abspath</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">testtools.matchers</span> <span class="k">import</span> <span class="n">Equals</span>

<span class="k">class</span> <span class="nc">MainWindowTitleTests</span><span class="p">(</span><span class="n">AutopilotTestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">launch_application</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Work out the full path to the application and launch it.</span>

<span class="sd">        This is necessary since our test application will not be in $PATH.</span>

<span class="sd">        :returns: The application proxy object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">full_path</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;testapp.py&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">launch_test_application</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">app_type</span><span class="o">=</span><span class="s1">&#39;qt&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_main_window_title_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The main window title must be &#39;Hello World&#39;.&quot;&quot;&quot;</span>
        <span class="n">app_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">launch_application</span><span class="p">()</span>
        <span class="n">main_window</span> <span class="o">=</span> <span class="n">app_root</span><span class="o">.</span><span class="n">select_single</span><span class="p">(</span><span class="s1">&#39;QMainWindow&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertThat</span><span class="p">(</span><span class="n">main_window</span><span class="o">.</span><span class="n">windowTitle</span><span class="p">,</span> <span class="n">Equals</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that we have made the test method as readable as possible by hiding the complexities of finding the full path to the application we want to test. Of course, if you can guarantee that the application is in <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal"><span class="pre">PATH</span></code>, then this step becomes a lot simpler.</p>
<p>The entire directory structure looks like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">example</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="o">./</span><span class="n">example</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="o">./</span><span class="n">example</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">test_window</span><span class="o">.</span><span class="n">py</span>
<span class="o">./</span><span class="n">testapp</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">__init__.py</span></code> files are empty, and are needed to make these directories importable by python.</p>
<div class="section" id="running-autopilot">
<h3>Running Autopilot<a class="headerlink" href="#running-autopilot" title="Permalink to this headline">¶</a></h3>
<p>From the root of this directory structure, we can ask autopilot to list all the tests it can find:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ autopilot3 list example
Loading tests from: /home/thomi/code/canonical/autopilot/example_test

    example.tests.test_window.MainWindowTitleTests.test_main_window_title_string


 1 total tests.
</pre></div>
</div>
<p>Note that on the first line, autopilot will tell you where it has loaded the test definitions from. Autopilot will look in the current directory for a python package that matches the package name specified on the command line. If it does not find any suitable packages, it will look in the standard python module search path instead.</p>
<p>To run our test, we use the autopilot ‘run’ command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ autopilot3 run example
Loading tests from: /home/thomi/code/canonical/autopilot/example_test

Tests running...

Ran 1 test in 2.342s
OK
</pre></div>
</div>
<p>You will notice that the test application launches, and then dissapears shortly afterwards. Since this test doesn’t manipulate the application in any way, this is a rather boring test to look at. If you ever want more output from the run command, you may specify the ‘-v’ flag:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ autopilot3 run -v example
Loading tests from: /home/thomi/code/canonical/autopilot/example_test

Tests running...
13:41:11.614 INFO globals:49 - ************************************************************
13:41:11.614 INFO globals:50 - Starting test example.tests.test_window.MainWindowTitleTests.test_main_window_title_string
13:41:11.693 INFO __init__:136 - Launching process: [&#39;/home/thomi/code/canonical/autopilot/example_test/testapp.py&#39;, &#39;-testability&#39;]
13:41:11.699 INFO __init__:169 - Looking for autopilot interface for PID 12013 (and children)
13:41:11.727 WARNING __init__:185 - Caught exception while searching for autopilot interface: &#39;DBusException(&quot;Could not get PID of name &#39;org.freedesktop.DBus&#39;: no such name&quot;,)&#39;
13:41:12.773 WARNING __init__:185 - Caught exception while searching for autopilot interface: &#39;DBusException(&quot;Could not get PID of name &#39;org.freedesktop.DBus&#39;: no such name&quot;,)&#39;
13:41:12.848 WARNING __init__:185 - Caught exception while searching for autopilot interface: &#39;RuntimeError(&quot;Could not find Autopilot interface on DBus backend &#39;&lt;session bus :1.5967 /com/canonical/Autopilot/Introspection&gt;&#39;&quot;,)&#39;
13:41:12.852 WARNING __init__:185 - Caught exception while searching for autopilot interface: &#39;RuntimeError(&quot;Could not find Autopilot interface on DBus backend &#39;&lt;session bus :1.5968 /com/canonical/Autopilot/Introspection&gt;&#39;&quot;,)&#39;
13:41:12.863 WARNING dbus:464 - Generating introspection instance for type &#39;Root&#39; based on generic class.
13:41:12.864 DEBUG dbus:338 - Selecting objects of type QMainWindow with attributes: {}
13:41:12.871 WARNING dbus:464 - Generating introspection instance for type &#39;QMainWindow&#39; based on generic class.
13:41:12.886 INFO testcase:380 - waiting for process to exit.
13:41:13.983 INFO testresult:35 - OK: example.tests.test_window.MainWindowTitleTests.test_main_window_title_string

Ran 1 test in 2.370s
OK
</pre></div>
</div>
<p>You may also specify ‘-v’ twice for even more output (this is rarely useful for test authors however).</p>
<p>Both the ‘list’ and ‘run’ commands take a test id as an argument. You may be as generic, or as specific as you like. In the examples above, we will list and run all tests in the ‘example’ package (i.e.- all tests), but we could specify a more specific run criteria if we only wanted to run some of the tests. For example, to only run the single test we’ve written, we can execute:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ autopilot3 run example.tests.test_window.MainWindowTitleTests.test_main_window_title_string
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-test-with-interaction">
<span id="tut-test-with-interaction"></span><h2>A Test with Interaction<a class="headerlink" href="#a-test-with-interaction" title="Permalink to this headline">¶</a></h2>
<p>Now lets take a look at some simple tests with some user interaction. First, update the test application with some input and output controls:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># File: testapp.py</span>

<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="k">import</span> <span class="n">QtGui</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="k">import</span> <span class="n">argv</span>

<span class="k">class</span> <span class="nc">AutopilotHelloWorld</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AutopilotHelloWorld</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hello</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hello</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">say_hello</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">goodbye</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Goodbye&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goodbye</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">say_goodbye</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Response: None&quot;</span><span class="p">)</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hello</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goodbye</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">say_hello</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Response: Hello&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">say_goodbye</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Response: Goodbye&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">ahw</span> <span class="o">=</span> <span class="n">AutopilotHelloWorld</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
        <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>We’ve reorganized the application code into a class to make the event handling easier. Then we added two input controls, the <code class="docutils literal"><span class="pre">hello</span></code> and <code class="docutils literal"><span class="pre">goodbye</span></code> buttons and an output control, the <code class="docutils literal"><span class="pre">response</span></code> label.</p>
<p>The operation of the application is still very trivial, but now we can test that it actually does something in response to user input. Clicking either of the two buttons will cause the response text to change. Clicking the <code class="docutils literal"><span class="pre">Hello</span></code> button should result in <code class="docutils literal"><span class="pre">Response:</span> <span class="pre">Hello</span></code> while clicking the <code class="docutils literal"><span class="pre">Goodbye</span></code> button should result in <code class="docutils literal"><span class="pre">Response:</span> <span class="pre">Goodbye</span></code>.</p>
<p>Since we’re adding a new category of tests, button response tests, we should organize them into a new class. Our tests module now looks like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">autopilot.testcase</span> <span class="k">import</span> <span class="n">AutopilotTestCase</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">abspath</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">testtools.matchers</span> <span class="k">import</span> <span class="n">Equals</span>

<span class="kn">from</span> <span class="nn">autopilot.matchers</span> <span class="k">import</span> <span class="n">Eventually</span>

<span class="k">class</span> <span class="nc">HelloWorldTestBase</span><span class="p">(</span><span class="n">AutopilotTestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">launch_application</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Work out the full path to the application and launch it.</span>

<span class="sd">        This is necessary since our test application will not be in $PATH.</span>

<span class="sd">        :returns: The application proxy object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">full_path</span> <span class="o">=</span> <span class="n">abspath</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;testapp.py&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">launch_test_application</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">app_type</span><span class="o">=</span><span class="s1">&#39;qt&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MainWindowTitleTests</span><span class="p">(</span><span class="n">HelloWorldTestBase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_main_window_title_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The main window title must be &#39;Hello World&#39;.&quot;&quot;&quot;</span>
        <span class="n">app_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">launch_application</span><span class="p">()</span>
        <span class="n">main_window</span> <span class="o">=</span> <span class="n">app_root</span><span class="o">.</span><span class="n">select_single</span><span class="p">(</span><span class="s1">&#39;AutopilotHelloWorld&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertThat</span><span class="p">(</span><span class="n">main_window</span><span class="o">.</span><span class="n">windowTitle</span><span class="p">,</span> <span class="n">Equals</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">ButtonResponseTests</span><span class="p">(</span><span class="n">HelloWorldTestBase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_hello_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The response text must be &#39;Response: Hello&#39; after a Hello click.&quot;&quot;&quot;</span>
        <span class="n">app_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">launch_application</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">app_root</span><span class="o">.</span><span class="n">select_single</span><span class="p">(</span><span class="s1">&#39;QLabel&#39;</span><span class="p">)</span>
        <span class="n">hello</span> <span class="o">=</span> <span class="n">app_root</span><span class="o">.</span><span class="n">select_single</span><span class="p">(</span><span class="s1">&#39;QPushButton&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Hello&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mouse</span><span class="o">.</span><span class="n">click_object</span><span class="p">(</span><span class="n">hello</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertThat</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">Eventually</span><span class="p">(</span><span class="n">Equals</span><span class="p">(</span><span class="s1">&#39;Response: Hello&#39;</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">test_goodbye_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The response text must be &#39;Response: Goodbye&#39; after a Goodbye</span>
<span class="sd">        click.&quot;&quot;&quot;</span>
        <span class="n">app_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">launch_application</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">app_root</span><span class="o">.</span><span class="n">select_single</span><span class="p">(</span><span class="s1">&#39;QLabel&#39;</span><span class="p">)</span>
        <span class="n">goodbye</span> <span class="o">=</span> <span class="n">app_root</span><span class="o">.</span><span class="n">select_single</span><span class="p">(</span><span class="s1">&#39;QPushButton&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;Goodbye&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mouse</span><span class="o">.</span><span class="n">click_object</span><span class="p">(</span><span class="n">goodbye</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertThat</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">Eventually</span><span class="p">(</span><span class="n">Equals</span><span class="p">(</span><span class="s1">&#39;Response: Goodbye&#39;</span><span class="p">)))</span>
</pre></div>
</div>
<p>In addition to the new class, <code class="docutils literal"><span class="pre">ButtonResponseTests</span></code>, you’ll notice a few other changes. First, two new import lines were added to support the new tests. Next, the existing <code class="docutils literal"><span class="pre">MainWindowTitleTests</span></code> class was refactored to subclass from a base class, <code class="docutils literal"><span class="pre">HelloWorldTestBase</span></code>. The base class contains the <code class="docutils literal"><span class="pre">launch_application</span></code> method which is used for all test cases. Finally, the object type of the main window changed from <code class="docutils literal"><span class="pre">QMainWindow</span></code> to <code class="docutils literal"><span class="pre">AutopilotHelloWorld</span></code>. The change in object type is a result of our test application being refactored into a class called <code class="docutils literal"><span class="pre">AutopilotHelloWorld</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">ButtonResponseTests</span></code> class adds two new tests, one for each input control. Each test identifies the user interface controls that need to be used, performs a single, specific action, and then verifies the outcome. In <code class="docutils literal"><span class="pre">test_hello_response</span></code>, we first identify the <code class="docutils literal"><span class="pre">QLabel</span></code> control which contains the output we need to check. We then identify the <code class="docutils literal"><span class="pre">Hello</span></code> button. As the application has two <code class="docutils literal"><span class="pre">QPushButton</span></code> controls, we must further refine the <code class="docutils literal"><span class="pre">select_single</span></code> call by specifing an additional property. In this case, we use the button text. Next, an input action is triggered by instructing the <code class="docutils literal"><span class="pre">mouse</span></code> to click the <code class="docutils literal"><span class="pre">Hello</span></code> button. Finally, the test asserts that the response label text matches the expected string. The second test repeats the same process with the <code class="docutils literal"><span class="pre">Goodbye</span></code> button.</p>
</div>
<div class="section" id="the-eventually-matcher">
<h2>The Eventually Matcher<a class="headerlink" href="#the-eventually-matcher" title="Permalink to this headline">¶</a></h2>
<p>Notice that in the ButtonResponseTests tests above, the autopilot method <code class="xref py py-class docutils literal"><span class="pre">Eventually</span></code> is used in the assertion. This allows the assertion to be retried continuously until it either becomes true, or times out (the default timout is 10 seconds). This is necessary because the application and the autopilot tests run in different processes. Autopilot could test the assert before the application has completed its action. Using <code class="xref py py-class docutils literal"><span class="pre">Eventually</span></code> allows the application to complete its action without having to explicitly add delays to the tests.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/otto-64.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Writing Your First Test</a><ul>
<li><a class="reference internal" href="#files-and-directories">Files and Directories</a><ul>
<li><a class="reference internal" href="#a-minimal-test-case">A Minimal Test Case</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-setup-phase">The Setup Phase</a><ul>
<li><a class="reference internal" href="#starting-the-application">Starting the Application</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-simple-test">A Simple Test</a><ul>
<li><a class="reference internal" href="#running-autopilot">Running Autopilot</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-test-with-interaction">A Test with Interaction</a></li>
<li><a class="reference internal" href="#the-eventually-matcher">The Eventually Matcher</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <h4>Previous topic</h4>
  <p class="topless"><a href="tutorial.html"
                        title="previous chapter">Autopilot Tutorial</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="advanced_autopilot.html"
                        title="next chapter">Advanced Autopilot Features</a></p>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="advanced_autopilot.html" title="Advanced Autopilot Features"
             >next</a> |</li>
        <li class="right" >
          <a href="tutorial.html" title="Autopilot Tutorial"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Autopilot 1.5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="tutorial.html" >Autopilot Tutorial</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
      <div class=center_text>
        <a href="../faq/contribute.html">Learn how you can contribute!</a> / <a href="https://bugs.launchpad.net/autopilot/+filebug">File a bug</a>
     <br/>
      </div>
        &copy; Copyright 2012-2014, Canonical.
    </div>


  </body>
</html>